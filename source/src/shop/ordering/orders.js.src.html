<!DOCTYPE html><html lang="en" class="loading"><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no"><meta http-equiv="X-UA-Compatible" content="IE=edge"><link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"><title>orders.js</title><link href="../../../../dossier.css" rel="stylesheet" type="text/css"><script src="../../../../types.js" defer></script><header><button class="dossier-menu"><i class="material-icons">menu</i></button><form><input type="search" placeholder="Search" tabindex="1"><i class="material-icons">search</i></form></header><nav class="dossier-nav"></nav><div class="content"><main data-page-data="[null,null,null,[&quot;orders.js&quot;,&quot;src/shop/ordering/orders.js&quot;,[null,&quot;/**&quot;,&quot; * Bloombox: Orders&quot;,&quot; *&quot;,&quot; * @fileoverview Provides the ability to submit orders for pickup and delivery.&quot;,&quot; */&quot;,null,&quot;/*global goog */&quot;,null,&quot;goog.provide(&#39;bloombox.shop.SchedulingType&#39;);&quot;,null,&quot;goog.provide(&#39;bloombox.shop.order.Order&#39;);&quot;,&quot;goog.provide(&#39;bloombox.shop.order.OrderException&#39;);&quot;,&quot;goog.provide(&#39;bloombox.shop.order.OrderScheduling&#39;);&quot;,&quot;goog.provide(&#39;bloombox.shop.order.Type&#39;);&quot;,null,&quot;goog.require(&#39;bloombox.config.active&#39;);&quot;,null,&quot;goog.require(&#39;bloombox.logging.error&#39;);&quot;,&quot;goog.require(&#39;bloombox.logging.log&#39;);&quot;,null,&quot;goog.require(&#39;bloombox.product.Key&#39;);&quot;,&quot;goog.require(&#39;bloombox.product.Kind&#39;);&quot;,&quot;goog.require(&#39;bloombox.product.Weight&#39;);&quot;,null,&quot;goog.require(&#39;bloombox.shop.Customer&#39;);&quot;,&quot;goog.require(&#39;bloombox.shop.CustomerName&#39;);&quot;,&quot;goog.require(&#39;bloombox.shop.Item&#39;);&quot;,&quot;goog.require(&#39;bloombox.shop.Routine&#39;);&quot;,null,&quot;goog.require(&#39;bloombox.shop.order.DeliveryLocation&#39;);&quot;,null,&quot;goog.require(&#39;bloombox.shop.rpc.ShopRPC&#39;);&quot;,null,&quot;goog.require(&#39;proto.commerce.Item&#39;);&quot;,&quot;goog.require(&#39;proto.commerce.Order&#39;);&quot;,&quot;goog.require(&#39;proto.commerce.OrderScheduling&#39;);&quot;,&quot;goog.require(&#39;proto.commerce.OrderType&#39;);&quot;,&quot;goog.require(&#39;proto.commerce.ProductVariant&#39;);&quot;,&quot;goog.require(&#39;proto.commerce.ProductWeight&#39;);&quot;,&quot;goog.require(&#39;proto.commerce.SchedulingType&#39;);&quot;,&quot;goog.require(&#39;proto.commerce.VariantSpec&#39;);&quot;,null,&quot;goog.require(&#39;proto.services.shop.v1.OrderError&#39;);&quot;,&quot;goog.require(&#39;proto.services.shop.v1.SubmitOrder.Request&#39;);&quot;,&quot;goog.require(&#39;proto.services.shop.v1.SubmitOrder.Response&#39;);&quot;,null,&quot;goog.require(&#39;proto.temporal.Instant&#39;);&quot;,null,null,&quot;// -- Structures -- //&quot;,&quot;/**&quot;,&quot; * Callback function for order submission.&quot;,&quot; *&quot;,&quot; * @typedef {function(?string, ?bloombox.shop.order.Order, ?number=)}&quot;,&quot; */&quot;,&quot;bloombox.shop.OrderCallback;&quot;,null,null,&quot;/**&quot;,&quot; * Specifies types of orders.&quot;,&quot; *&quot;,&quot; * @enum {number}&quot;,&quot; * @export&quot;,&quot; */&quot;,&quot;bloombox.shop.order.Type = {&quot;,&quot;  &#39;PICKUP&#39;: proto.commerce.OrderType.PICKUP,&quot;,&quot;  &#39;DELIVERY&#39;: proto.commerce.OrderType.DELIVERY&quot;,&quot;};&quot;,null,null,&quot;/**&quot;,&quot; * Specifies types of order scheduling.&quot;,&quot; *&quot;,&quot; * @enum {number}&quot;,&quot; * @export&quot;,&quot; */&quot;,&quot;bloombox.shop.SchedulingType = {&quot;,&quot;  &#39;ASAP&#39;: proto.commerce.SchedulingType.ASAP,&quot;,&quot;  &#39;TIMED&#39;: proto.commerce.SchedulingType.TIMED&quot;,&quot;};&quot;,null,null,&quot;/**&quot;,&quot; * Represents an exception that occurred while preparing or submitting&quot;,&quot; * an order.&quot;,&quot; *&quot;,&quot; * @param {string} message Exception error message.&quot;,&quot; * @constructor&quot;,&quot; * @export&quot;,&quot; */&quot;,&quot;bloombox.shop.order.OrderException = function OrderException(message) {&quot;,&quot;  this.message = message;&quot;,&quot;};&quot;,null,null,&quot;// -- Order Scheduling -- //&quot;,&quot;/**&quot;,&quot; * Specifies scheduling options for an order.&quot;,&quot; *&quot;,&quot; * @param {bloombox.shop.SchedulingType} scheduling Scheduling type to apply.&quot;,&quot; * @param {?number} desiredTime Desired time to set for delivery or pickup.&quot;,&quot; * @constructor&quot;,&quot; * @export&quot;,&quot; */&quot;,&quot;bloombox.shop.order.OrderScheduling = function OrderScheduling(scheduling,&quot;,&quot;                                                               desiredTime) {&quot;,&quot;  this.scheduling = scheduling;&quot;,&quot;  this.desiredTime = desiredTime;&quot;,&quot;};&quot;,null,null,&quot;/**&quot;,&quot; * Export this order scheduling specification as a proto object suitable&quot;,&quot; * for use in an RPC.&quot;,&quot; *&quot;,&quot; * @return {proto.commerce.OrderScheduling} Proto order scheduling spec.&quot;,&quot; * @package&quot;,&quot; */&quot;,&quot;bloombox.shop.order.OrderScheduling.prototype.export = function() {&quot;,&quot;  let protob = new proto.commerce.OrderScheduling();&quot;,&quot;  protob.setScheduling(/** @type {proto.commerce.SchedulingType&lt;number&gt;} */ (&quot;,&quot;      this.scheduling));&quot;,null,&quot;  // set desired time, if applicable&quot;,&quot;  if (this.desiredTime !== null) {&quot;,&quot;    let desiredTime = new proto.temporal.Instant();&quot;,&quot;    desiredTime.setTimestamp(this.desiredTime);&quot;,&quot;    protob.setDesiredTime(desiredTime);&quot;,&quot;  }&quot;,&quot;  return protob;&quot;,&quot;};&quot;,null,null,&quot;/**&quot;,&quot; * Retrieve the scheduling type for this scheduling spec.&quot;,&quot; * @return {bloombox.shop.SchedulingType} Scheduling type.&quot;,&quot; * @export&quot;,&quot; */&quot;,&quot;bloombox.shop.order.OrderScheduling.prototype.getScheduling = function() {&quot;,&quot;  return this.scheduling;&quot;,&quot;};&quot;,null,null,&quot;/**&quot;,&quot; * Retrieve the desired delivery or pickup target time.&quot;,&quot; * @return {?number} Target time, or `null` if not applicable.&quot;,&quot; * @export&quot;,&quot; */&quot;,&quot;bloombox.shop.order.OrderScheduling.prototype.getDesiredTime = function() {&quot;,&quot;  return this.desiredTime;&quot;,&quot;};&quot;,null,null,&quot;// -- Order -- //&quot;,&quot;/**&quot;,&quot; * Specifies an order that can be submitted for pickup or delivery.&quot;,&quot; *&quot;,&quot; * @param {bloombox.shop.order.Type} orderType Type of order to build.&quot;,&quot; * @param {bloombox.shop.Customer} customer Customer submitting the order.&quot;,&quot; * @param {?bloombox.shop.order.DeliveryLocation} location Delivery location.&quot;,&quot; * @param {string=} notes Order notes or special instructions.&quot;,&quot; * @throws {bloombox.shop.order.OrderException} If params provided are invalid.&quot;,&quot; * @constructor&quot;,&quot; * @export&quot;,&quot; */&quot;,&quot;bloombox.shop.order.Order = function Order(orderType,&quot;,&quot;                                           customer,&quot;,&quot;                                           location,&quot;,&quot;                                           notes) {&quot;,&quot;  // check order type&quot;,&quot;  if (!(orderType === bloombox.shop.order.Type.PICKUP ||&quot;,&quot;        orderType === bloombox.shop.order.Type.DELIVERY))&quot;,&quot;    throw new bloombox.shop.order.OrderException(&quot;,&quot;      &#39;Invalid order type provided. Must be DELIVERY or PICKUP.&#39;);&quot;,null,&quot;  // check customer&quot;,&quot;  if (!(typeof customer === &#39;object&#39; &amp;&amp; (&quot;,&quot;      typeof customer.export === &#39;function&#39;)))&quot;,&quot;    throw new bloombox.shop.order.OrderException(&quot;,&quot;      &#39;Invalid customer provided for order.&#39;);&quot;,null,&quot;  // check location&quot;,&quot;  if (orderType === bloombox.shop.order.Type.DELIVERY &amp;&amp;&quot;,&quot;      (location === null || !(typeof location === &#39;object&#39;) || !location))&quot;,&quot;    // we need a location - it&#39;s type `DELIVERY` - but we didn&#39;t get one&quot;,&quot;    throw new bloombox.shop.order.OrderException(&quot;,&quot;      &#39;Order type was DELIVERY, but no destination info was provided.&#39;);&quot;,null,&quot;  // okay everything is valid&quot;,&quot;  this.type = orderType;&quot;,&quot;  this.customer = customer;&quot;,&quot;  this.items = [];&quot;,&quot;  this.location = location;&quot;,&quot;  this.notes = notes || null;&quot;,&quot;  this.scheduling = new bloombox.shop.order.OrderScheduling(&quot;,&quot;    bloombox.shop.SchedulingType.ASAP, null);&quot;,&quot;  this.createdAt = {&quot;,&quot;    timestamp: +(new Date())&quot;,&quot;  };&quot;,&quot;};&quot;,null,null,&quot;// noinspection JSUnusedGlobalSymbols&quot;,&quot;/**&quot;,&quot; * Set an order to ASAP-style scheduling.&quot;,&quot; *&quot;,&quot; * @return {bloombox.shop.order.Order} Subject order, for chainability.&quot;,&quot; * @export&quot;,&quot; */&quot;,&quot;bloombox.shop.order.Order.prototype.setSchedulingTypeASAP = function() {&quot;,&quot;  this.scheduling = new bloombox.shop.order.OrderScheduling(&quot;,&quot;    bloombox.shop.SchedulingType.ASAP, null);&quot;,&quot;  return this;&quot;,&quot;};&quot;,null,null,&quot;// noinspection JSUnusedGlobalSymbols&quot;,&quot;/**&quot;,&quot; * Set an order to a specific target delivery time.&quot;,&quot; *&quot;,&quot; * @param {number} ts Timestamp for delivery target.&quot;,&quot; * @return {bloombox.shop.order.Order} Subject order, for chainability.&quot;,&quot; * @throws {bloombox.shop.order.OrderException} If the provided timestamp is not&quot;,&quot; *         valid.&quot;,&quot; * @export&quot;,&quot; */&quot;,&quot;bloombox.shop.order.Order.prototype.setSchedulingTypeTimed = function(ts) {&quot;,&quot;  // check timestamp&quot;,&quot;  if (!((typeof ts === &#39;number&#39;) &amp;&amp; (ts &gt; 100)))&quot;,&quot;    throw new bloombox.shop.order.OrderException(&quot;,&quot;      &#39;Invalid timestamp provided for setSchedulingTypeTimed.&#39;);&quot;,null,&quot;  this.scheduling = new bloombox.shop.order.OrderScheduling(&quot;,&quot;    bloombox.shop.SchedulingType.TIMED, ts);&quot;,&quot;  return this;&quot;,&quot;};&quot;,null,null,&quot;/**&quot;,&quot; * Set the type of order.&quot;,&quot; *&quot;,&quot; * @param {bloombox.shop.order.Type} type Type to set the order to.&quot;,&quot; * @return {bloombox.shop.order.Order} Subject order, for chain-ability.&quot;,&quot; * @throws {bloombox.shop.order.OrderException} If the provided type isn&#39;t valid&quot;,&quot; * @export&quot;,&quot; */&quot;,&quot;bloombox.shop.order.Order.prototype.setType = function(type) {&quot;,&quot;  // check validity&quot;,&quot;  if (type !== bloombox.shop.order.Type.PICKUP &amp;&amp; (&quot;,&quot;      type !== bloombox.shop.order.Type.DELIVERY))&quot;,&quot;    throw new bloombox.shop.order.OrderException(&quot;,&quot;      &#39;Invalid order type provided to Order.setType. &#39; +&quot;,&quot;        &#39;Must be one of `bloombox.shop.order.Type.DELIVERY` &#39; +&quot;,&quot;        &#39;or `bloombox.shop.order.Type.PICKUP`.&#39;);&quot;,null,&quot;  this.type = type;&quot;,&quot;  return this;&quot;,&quot;};&quot;,null,null,&quot;/**&quot;,&quot; * Set the notes for the order.&quot;,&quot; *&quot;,&quot; * @param {?string} notes Notes for the order, or `null` to unset notes.&quot;,&quot; * @return {bloombox.shop.order.Order} Subject order, for chain-ability.&quot;,&quot; * @throws {bloombox.shop.order.OrderException} If the provided type isn&#39;t valid&quot;,&quot; * @export&quot;,&quot; */&quot;,&quot;bloombox.shop.order.Order.prototype.setNotes = function(notes) {&quot;,&quot;  // check validity&quot;,&quot;  if (notes === null) {&quot;,&quot;    // we&#39;re clearing notes&quot;,&quot;    this.notes = null;&quot;,&quot;  } else if (typeof notes === &#39;string&#39; &amp;&amp; notes.length &gt; 0) {&quot;,&quot;    // it&#39;s notes&quot;,&quot;    this.notes = notes;&quot;,&quot;  } else {&quot;,&quot;    // it&#39;s an invalid type&quot;,&quot;    throw new bloombox.shop.order.OrderException(&quot;,&quot;      &#39;Notes for order aren\\&#39;t valid: \\&#39;&#39; + notes + &#39;\\&#39;.&#39;);&quot;,&quot;  }&quot;,&quot;  return this;&quot;,&quot;};&quot;,null,null,&quot;/**&quot;,&quot; * Set the location for a delivery order.&quot;,&quot; *&quot;,&quot; * @param {?bloombox.shop.order.DeliveryLocation} location Location to set.&quot;,&quot; * @return {bloombox.shop.order.Order} Subject order, for chain-ability.&quot;,&quot; * @throws {bloombox.shop.order.OrderException} If the provided location isn&#39;t&quot;,&quot; *         valid in some way.&quot;,&quot; * @export&quot;,&quot; */&quot;,&quot;bloombox.shop.order.Order.prototype.setLocation = function(location) {&quot;,&quot;  // check validity&quot;,&quot;  if (location !== null &amp;&amp; (!(typeof location === &#39;object&#39;) ||&quot;,&quot;        !(typeof location.export === &#39;function&#39;)))&quot;,&quot;    throw new bloombox.shop.order.OrderException(&quot;,&quot;      &#39;Invalid delivery destination provided to Order.setLocation.&#39;);&quot;,null,&quot;  this.location = location;&quot;,&quot;  return this;&quot;,&quot;};&quot;,null,null,&quot;/**&quot;,&quot; * Get the type of order.&quot;,&quot; * @return {bloombox.shop.order.Type} Order type.&quot;,&quot; * @export&quot;,&quot; */&quot;,&quot;bloombox.shop.order.Order.prototype.getType = function() {&quot;,&quot;  return this.type;&quot;,&quot;};&quot;,null,null,&quot;/**&quot;,&quot; * Get the notes for the order.&quot;,&quot; * @return {?string} Order notes, or `null` if no notes were specified.&quot;,&quot; * @export&quot;,&quot; */&quot;,&quot;bloombox.shop.order.Order.prototype.getNotes = function() {&quot;,&quot;  return this.notes;&quot;,&quot;};&quot;,null,null,&quot;/**&quot;,&quot; * Set the customer for this order.&quot;,&quot; *&quot;,&quot; * @param {bloombox.shop.Customer} customer Customer to set.&quot;,&quot; * @return {bloombox.shop.order.Order} Subject order, for chain-ability.&quot;,&quot; * @throws {bloombox.shop.order.OrderException} If the provided customer is not&quot;,&quot; *         valid in some way.&quot;,&quot; * @export&quot;,&quot; */&quot;,&quot;bloombox.shop.order.Order.prototype.setCustomer = function(customer) {&quot;,&quot;  // check validity&quot;,&quot;  if (customer !== null &amp;&amp; (!(typeof customer === &#39;object&#39;) ||&quot;,&quot;        !(typeof customer.export === &#39;function&#39;)))&quot;,&quot;    throw new bloombox.shop.order.OrderException(&quot;,&quot;      &#39;Invalid customer provided to Order.setCustomer.&#39;);&quot;,null,&quot;  this.customer = customer;&quot;,&quot;  return this;&quot;,&quot;};&quot;,null,null,&quot;/**&quot;,&quot; * Get the customer for this order.&quot;,&quot; * @return {bloombox.shop.Customer} Order customer.&quot;,&quot; * @export&quot;,&quot; */&quot;,&quot;bloombox.shop.order.Order.prototype.getCustomer = function() {&quot;,&quot;  return this.customer;&quot;,&quot;};&quot;,null,null,&quot;/**&quot;,&quot; * Add an item to this order.&quot;,&quot; *&quot;,&quot; * @param {bloombox.shop.Item} item Item to add to the order.&quot;,&quot; * @return {bloombox.shop.order.Order} Subject order, for chain-ability.&quot;,&quot; * @throws {bloombox.shop.order.OrderException} If the provided item is not&quot;,&quot; *         valid in some way.&quot;,&quot; * @export&quot;,&quot; */&quot;,&quot;bloombox.shop.order.Order.prototype.addItem = function(item) {&quot;,&quot;  // check validity&quot;,&quot;  if (item !== null &amp;&amp; (!(typeof item === &#39;object&#39;) ||&quot;,&quot;        !(typeof item.export === &#39;function&#39;)))&quot;,&quot;    throw new bloombox.shop.order.OrderException(&quot;,&quot;      &#39;Invalid item provided to Order.addItem&#39;);&quot;,null,&quot;  this.items.push(item);&quot;,&quot;  return this;&quot;,&quot;};&quot;,null,null,&quot;/**&quot;,&quot; * Submit the order for fulfillment.&quot;,&quot; *&quot;,&quot; * @param {bloombox.shop.OrderCallback} callback Order callback.&quot;,&quot; * @export&quot;,&quot; */&quot;,&quot;bloombox.shop.order.Order.prototype.send = function(callback) {&quot;,&quot;  // set basic properties&quot;,&quot;  let payload = new proto.commerce.Order();&quot;,&quot;  payload.setType(/** @type {proto.commerce.OrderType&lt;number&gt;} */ (this.type));&quot;,null,&quot;  // add notes, if any are specified&quot;,&quot;  let notes = this.notes;&quot;,&quot;  if (notes !== null) payload.setNotes(notes);&quot;,null,&quot;  // add the customer proto&quot;,&quot;  let customer = this.customer.export();&quot;,&quot;  payload.setCustomer(customer);&quot;,null,&quot;  // add scheduling info&quot;,&quot;  let scheduling = this.scheduling.export();&quot;,&quot;  payload.setScheduling(scheduling);&quot;,null,&quot;  // add location info, if it&#39;s delivery&quot;,&quot;  if (this.type === bloombox.shop.order.Type.DELIVERY) {&quot;,&quot;    let location = this.location.export();&quot;,&quot;    payload.setDestination(location);&quot;,&quot;  }&quot;,null,&quot;  this.items.map(function(item) {&quot;,&quot;    let itemobj = /** @type {bloombox.shop.Item} */ (item);&quot;,&quot;    let protob = /** @type {!proto.commerce.Item} */ (itemobj.export());&quot;,&quot;    payload.addItem(protob);&quot;,&quot;  });&quot;,null,&quot;  let done = false;&quot;,null,&quot;  let config = bloombox.config.active();&quot;,&quot;  let partner = config.partner;&quot;,&quot;  let location = config.location;&quot;,null,&quot;  if (!partner || !location) {&quot;,&quot;    bloombox.logging.error(&#39;Partner or location code is not defined.&#39;);&quot;,&quot;    return;&quot;,&quot;  }&quot;,null,&quot;  let serializedItems = this.items.map(function(item) {&quot;,&quot;    return {&quot;,&quot;      &#39;count&#39;: item.count || 1,&quot;,&quot;      &#39;key&#39;: {&quot;,&quot;        &#39;id&#39;: item.key.id,&quot;,&quot;        &#39;type&#39;: {&quot;,&quot;          &#39;kind&#39;: item.key.kind&quot;,&quot;        }&quot;,&quot;      },&quot;,&quot;      &#39;variant&#39;: item.variants.map(function(variant) {&quot;,&quot;        let baseVariant = {&quot;,&quot;          &#39;variant&#39;: variant.getVariant(),&quot;,&quot;        };&quot;,null,&quot;        if (variant.getWeight()) {&quot;,&quot;          baseVariant[&#39;weight&#39;] = variant.getWeight();&quot;,&quot;        } else if (variant.getSize()) {&quot;,&quot;          baseVariant[&#39;size&#39;] = variant.getSize();&quot;,&quot;        } else if (variant.getColor()) {&quot;,&quot;          baseVariant[&#39;color&#39;] = variant.getColor();&quot;,&quot;        }&quot;,&quot;        return baseVariant;&quot;,&quot;      })&quot;,&quot;    };&quot;,&quot;  });&quot;,null,&quot;  let payloadObject = {&quot;,&quot;    &#39;type&#39;: payload.getType(),&quot;,&quot;    &#39;partnerCode&#39;: partner,&quot;,&quot;    &#39;locationCode&#39;: location,&quot;,&quot;    &#39;customer&#39;: {&quot;,&quot;      &#39;person&#39;: {&quot;,&quot;        &#39;name&#39;: {&quot;,&quot;          &#39;firstName&#39;: this.customer.person.name.getFirstName(),&quot;,&quot;          &#39;lastName&#39;: this.customer.person.name.getLastName()&quot;,&quot;        },&quot;,&quot;        &#39;contact&#39;: {&quot;,&quot;          &#39;email&#39;: {&#39;address&#39;: this.customer.person.contactInfo.emailAddress},&quot;,&quot;          &#39;phone&#39;: {&#39;e164&#39;: this.customer.person.contactInfo.phoneNumber}&quot;,&quot;        }&quot;,&quot;      },&quot;,&quot;      &#39;foreignId&#39;: this.customer.foreignId&quot;,&quot;    },&quot;,&quot;    &#39;scheduling&#39;: {&quot;,&quot;      &#39;scheduling&#39;: payload.getScheduling().getScheduling()&quot;,&quot;    },&quot;,&quot;    &#39;item&#39;: serializedItems&quot;,&quot;  };&quot;,null,&quot;  if (typeof payload.getNotes() === &#39;string&#39;) {&quot;,&quot;    payloadObject[&#39;notes&#39;] = payload.getNotes();&quot;,&quot;  }&quot;,null,&quot;  if (payload.getType() === bloombox.shop.order.Type.DELIVERY) {&quot;,&quot;    if (!payload.getDestination() || !payload.getDestination().getAddress())&quot;,&quot;      throw new bloombox.shop.order.OrderException(&quot;,&quot;        &#39;Missing destination information, but order type is DELIVERY.&#39;);&quot;,&quot;    payloadObject[&#39;destination&#39;] = {&quot;,&quot;      &#39;address&#39;: {&quot;,&quot;        &#39;firstLine&#39;: payload.getDestination().getAddress().getFirstLine(),&quot;,&quot;        &#39;city&#39;: payload.getDestination().getAddress().getCity(),&quot;,&quot;        &#39;state&#39;: payload.getDestination().getAddress().getState(),&quot;,&quot;        &#39;zipcode&#39;: payload.getDestination().getAddress().getZipcode(),&quot;,&quot;        &#39;country&#39;: &#39;USA&#39;  // @TODO maybe make this configurable&quot;,&quot;      }&quot;,&quot;    };&quot;,&quot;    if (payload.getNotes())&quot;,&quot;      payloadObject[&#39;notes&#39;] = payload.getNotes();&quot;,null,&quot;    if (payload.getDestination().getAddress().getSecondLine())&quot;,&quot;      payloadObject[&#39;destination&#39;][&#39;address&#39;][&#39;secondLine&#39;] = (&quot;,&quot;        payload.getDestination().getAddress().getSecondLine());&quot;,null,&quot;    if (payload.getDestination().getInstructions())&quot;,&quot;      payloadObject[&#39;destination&#39;][&#39;instructions&#39;] = (&quot;,&quot;        payload.getDestination().getInstructions());&quot;,&quot;  }&quot;,null,&quot;  // make the RPC&quot;,&quot;  new bloombox.shop.rpc.ShopRPC(&quot;,&quot;    /** @type {bloombox.shop.Routine} */ (&quot;,&quot;      bloombox.shop.Routine.SUBMIT_ORDER), &#39;POST&#39;, [&quot;,&quot;        &#39;partners&#39;,&quot;,&quot;        partner,&quot;,&quot;        &#39;locations&#39;,&quot;,&quot;        location,&quot;,&quot;        &#39;orders&#39;&quot;,&quot;    ].join(&#39;/&#39;), payloadObject)&quot;,&quot;    .send((function(response) {&quot;,&quot;      if (done) return;&quot;,&quot;      if (response != null) {&quot;,&quot;        done = true;&quot;,null,&quot;        bloombox.logging.log(&quot;,&quot;          &#39;Response received for order submission RPC.&#39;, response);&quot;,null,&quot;        // decode the response&quot;,&quot;        let inflated = new proto.services.shop.v1.SubmitOrder.Response();&quot;,&quot;        if (response[&#39;error&#39;])&quot;,&quot;          inflated.setError(response[&#39;error&#39;]);&quot;,&quot;        inflated.setOrderId(response[&#39;orderId&#39;]);&quot;,null,&quot;        if ((&quot;,&quot;          inflated.getError() === proto.services.shop.v1.OrderError.NO_ERROR) &amp;&amp;&quot;,&quot;            inflated.getOrderId()) {&quot;,&quot;          this.id = inflated.getOrderId();&quot;,&quot;          callback(/** @type {string} */ (inflated.getOrderId()), this, null);&quot;,&quot;          return;&quot;,&quot;        } else {&quot;,&quot;          bloombox.logging.error(&quot;,&quot;              &#39;Server indicated order submission failed.&#39;, response);&quot;,&quot;          callback(null, null, inflated.getError());&quot;,&quot;        }&quot;,&quot;      }&quot;,&quot;      callback(null, null);  // an error occurred&quot;,&quot;    }).bind(this), function(status) {&quot;,&quot;      // we got an error&quot;,&quot;      bloombox.logging.error(&quot;,&quot;          &#39;Order submission RPC failed with status: &#39;, status);&quot;,&quot;      callback(null, null, status);&quot;,&quot;    });&quot;,&quot;};&quot;]]]"></main><footer><div><a href="https://github.com/jleyba/js-dossier">Generated by dossier</a></div></footer></div><script src="../../../../dossier.js" defer></script>